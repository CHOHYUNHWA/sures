<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/base}"
      lang="ko">
<head>
    <title>관리자 회원가입</title>
    <style>
        .form-hint {
            font-size: 0.75rem;
            color: #666;
            margin-top: 0.25rem;
        }
        .form-input.error {
            border-color: var(--color-danger);
        }
        .form-error {
            font-size: 0.75rem;
            color: var(--color-danger);
            margin-top: 0.25rem;
            display: none;
        }
        .form-input.error + .form-hint + .form-error,
        .form-input.error + .form-error {
            display: block;
        }
    </style>
</head>
<body>
    <th:block layout:fragment="header">
        <header class="header">
            <div class="container">
                <div class="header-inner" style="justify-content: center;">
                    <a th:href="@{/customer}" class="logo">
                        <img th:src="@{/image/logo.png}" alt="Sures 로고">
                        <span class="logo-text">Sures</span>
                    </a>
                </div>
            </div>
        </header>
    </th:block>

    <th:block layout:fragment="content">
        <div class="container" style="max-width: 400px; padding-top: 2rem;">
            <h1 class="text-center mb-3">관리자 회원가입</h1>

            <!-- 에러 메시지 -->
            <div th:if="${error}" class="alert alert-error">
                <span th:text="${error}">에러 메시지</span>
            </div>

            <div class="card">
                <div class="card-body">
                    <form th:action="@{/admin/register}" method="post" id="registerForm" novalidate>
                        <div class="form-group">
                            <label class="form-label" for="username">아이디 *</label>
                            <input type="text" class="form-input" id="username" name="username"
                                   placeholder="아이디 (영문 소문자, 숫자 4~20자)"
                                   minlength="4" maxlength="20"
                                   pattern="^[a-z0-9]+$"
                                   required autocomplete="username">

                            <div class="form-error" id="usernameError"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="password">비밀번호 *</label>
                            <input type="password" class="form-input" id="password" name="password"
                                   placeholder="비밀번호 (8자 이상, 영문+숫자+특수문자)"
                                   minlength="8"
                                   required autocomplete="new-password">

                            <div class="form-error" id="passwordError"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="passwordConfirm">비밀번호 확인 *</label>
                            <input type="password" class="form-input" id="passwordConfirm" name="passwordConfirm"
                                   placeholder="비밀번호를 다시 입력하세요"
                                   required autocomplete="new-password">
                            <div class="form-error" id="passwordConfirmError"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="name">이름 *</label>
                            <input type="text" class="form-input" id="name" name="name"
                                   placeholder="이름 (2~20자)"
                                   minlength="2" maxlength="20"
                                   required>

                            <div class="form-error" id="nameError"></div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="email">이메일 *</label>
                            <input type="email" class="form-input" id="email" name="email"
                                   placeholder="이메일을 입력하세요"
                                   required>
                            <div class="form-error" id="emailError"></div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-block btn-lg">
                            회원가입
                        </button>
                    </form>

                    <div class="mt-3 text-center" style="font-size: 0.875rem;">
                        이미 계정이 있으신가요? <a th:href="@{/admin/login}">로그인</a>
                    </div>
                </div>
            </div>
        </div>
    </th:block>

    <th:block layout:fragment="scripts">
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const form = document.getElementById('registerForm');
                const username = document.getElementById('username');
                const password = document.getElementById('password');
                const passwordConfirm = document.getElementById('passwordConfirm');
                const name = document.getElementById('name');
                const email = document.getElementById('email');

                // Validation patterns
                const usernamePattern = /^[a-z0-9]+$/;
                const passwordPattern = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[@$!%*#?&])[A-Za-z\d@$!%*#?&]+$/;
                const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

                // Show error
                function showError(input, message) {
                    input.classList.add('error');
                    const errorEl = document.getElementById(input.id + 'Error');
                    if (errorEl) {
                        errorEl.textContent = message;
                        errorEl.style.display = 'block';
                    }
                }

                // Clear error
                function clearError(input) {
                    input.classList.remove('error');
                    const errorEl = document.getElementById(input.id + 'Error');
                    if (errorEl) {
                        errorEl.textContent = '';
                        errorEl.style.display = 'none';
                    }
                }

                // Validate username
                function validateUsername() {
                    const value = username.value.trim();
                    if (!value) {
                        showError(username, '아이디를 입력해주세요');
                        return false;
                    }
                    if (value.length < 4 || value.length > 20) {
                        showError(username, '아이디는 4~20자로 입력해주세요');
                        return false;
                    }
                    if (!usernamePattern.test(value)) {
                        showError(username, '아이디는 영문 소문자와 숫자만 사용 가능합니다');
                        return false;
                    }
                    clearError(username);
                    return true;
                }

                // Validate password
                function validatePassword() {
                    const value = password.value;
                    if (!value) {
                        showError(password, '비밀번호를 입력해주세요');
                        return false;
                    }
                    if (value.length < 8) {
                        showError(password, '비밀번호는 8자 이상이어야 합니다');
                        return false;
                    }
                    if (!passwordPattern.test(value)) {
                        showError(password, '비밀번호는 영문, 숫자, 특수문자를 포함해야 합니다');
                        return false;
                    }
                    clearError(password);
                    return true;
                }

                // Validate password confirm
                function validatePasswordConfirm() {
                    if (!passwordConfirm.value) {
                        showError(passwordConfirm, '비밀번호 확인을 입력해주세요');
                        return false;
                    }
                    if (password.value !== passwordConfirm.value) {
                        showError(passwordConfirm, '비밀번호가 일치하지 않습니다');
                        return false;
                    }
                    clearError(passwordConfirm);
                    return true;
                }

                // Validate name
                function validateName() {
                    const value = name.value.trim();
                    if (!value) {
                        showError(name, '이름을 입력해주세요');
                        return false;
                    }
                    if (value.length < 2 || value.length > 20) {
                        showError(name, '이름은 2~20자로 입력해주세요');
                        return false;
                    }
                    clearError(name);
                    return true;
                }

                // Validate email
                function validateEmail() {
                    const value = email.value.trim();
                    if (!value) {
                        showError(email, '이메일을 입력해주세요');
                        return false;
                    }
                    if (!emailPattern.test(value)) {
                        showError(email, '올바른 이메일 형식이 아닙니다');
                        return false;
                    }
                    clearError(email);
                    return true;
                }

                // Real-time validation on blur
                username.addEventListener('blur', validateUsername);
                password.addEventListener('blur', validatePassword);
                passwordConfirm.addEventListener('blur', validatePasswordConfirm);
                name.addEventListener('blur', validateName);
                email.addEventListener('blur', validateEmail);

                // Clear error on input
                [username, password, passwordConfirm, name, email].forEach(input => {
                    input.addEventListener('input', () => clearError(input));
                });

                // Form submit validation
                form.addEventListener('submit', function(e) {
                    const isUsernameValid = validateUsername();
                    const isPasswordValid = validatePassword();
                    const isPasswordConfirmValid = validatePasswordConfirm();
                    const isNameValid = validateName();
                    const isEmailValid = validateEmail();

                    if (!isUsernameValid || !isPasswordValid || !isPasswordConfirmValid || !isNameValid || !isEmailValid) {
                        e.preventDefault();
                        // Focus first error field
                        const firstError = form.querySelector('.form-input.error');
                        if (firstError) firstError.focus();
                    }
                });
            });
        </script>
    </th:block>
</body>
</html>