<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/admin-layout}"
      lang="ko">
<head>
    <title>예약 상세</title>
    <style>
        /* 상태 뱃지 */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.4rem 0.85rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        .status-badge.confirmed { background: rgba(40, 167, 225, 0.12); color: #1a8bc9; }
        .status-badge.completed { background: rgba(40, 167, 94, 0.12); color: #1e7e45; }
        .status-badge.cancelled { background: rgba(220, 53, 69, 0.12); color: #c82333; }
        .status-badge.no_show { background: rgba(108, 117, 125, 0.12); color: #545b62; }

        /* 정보 그리드 */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.25rem;
        }
        @media (max-width: 480px) {
            .info-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }
        .info-item {
            padding: 0.75rem;
            background: var(--color-bg-light);
            border-radius: 8px;
        }
        .info-label {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 0.3rem;
        }
        .info-value {
            font-size: 0.95rem;
            color: var(--color-text);
            font-weight: 500;
        }

        /* 메모 섹션 */
        .memo-section {
            margin-top: 1.25rem;
            padding: 1rem;
            background: var(--color-bg-light);
            border-radius: 8px;
            border-left: 3px solid var(--color-accent);
        }
        .memo-section .info-label {
            margin-bottom: 0.5rem;
        }
        .memo-section .info-value {
            white-space: pre-wrap;
            line-height: 1.5;
        }

        /* 알림 메시지 */
        .alert {
            padding: 0.875rem 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }
        .alert-success {
            background: #d4edda;
            color: #155724;
        }
        .alert-error {
            background: #f8d7da;
            color: #721c24;
        }

        /* 예약번호 헤더 */
        .reservation-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: linear-gradient(135deg, var(--color-primary) 0%, #022a6e 100%);
            color: #fff;
            border-radius: 8px 8px 0 0;
            margin: -1.5rem -1.5rem 1.25rem -1.5rem;
        }
        .reservation-number {
            font-weight: 600;
            font-size: 0.95rem;
        }

        /* 취소된 예약 배너 */
        .cancelled-banner {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            color: #991b1b;
            font-weight: 500;
            margin-bottom: 1rem;
        }

        /* 하단 액션 영역 */
        .detail-actions {
            margin-top: 1.5rem;
        }
        .action-buttons {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        .action-buttons .btn {
            flex: 1;
            justify-content: center;
        }

        /* 상태 변경 카드 */
        .status-card {
            background: #fff;
            border: 1px solid var(--color-border);
            border-radius: 12px;
            padding: 1rem;
        }
        .status-card-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 0.75rem;
        }
        .status-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .status-btn {
            flex: 1;
            min-width: 80px;
            padding: 0.6rem 0.75rem;
            border: 2px solid;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            background: #fff;
            text-align: center;
        }
        .status-btn:hover:not(:disabled) {
            transform: translateY(-1px);
        }
        .status-btn.complete {
            border-color: #28a745;
            color: #28a745;
        }
        .status-btn.complete:hover:not(:disabled) {
            background: #28a745;
            color: #fff;
        }
        .status-btn.cancel {
            border-color: #dc3545;
            color: #dc3545;
        }
        .status-btn.cancel:hover:not(:disabled) {
            background: #dc3545;
            color: #fff;
        }
        .status-btn.noshow {
            border-color: #6c757d;
            color: #6c757d;
        }
        .status-btn.noshow:hover:not(:disabled) {
            background: #6c757d;
            color: #fff;
        }
        .status-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body>
    <th:block layout:fragment="page-content">
        <!-- 성공/에러 메시지 -->
        <div th:if="${success}" class="alert alert-success">
            <span th:text="${success}"></span>
        </div>
        <div th:if="${error}" class="alert alert-error">
            <span th:text="${error}"></span>
        </div>

        <h1 class="mb-3">예약 상세</h1>

        <!-- 취소된 예약 배너 -->
        <div th:if="${reservation.status.name() == 'CANCELLED'}" class="cancelled-banner">
            이 예약은 취소되었습니다
        </div>

        <!-- 예약 정보 카드 -->
        <div class="card mb-3">
            <div class="card-body" style="padding: 1.5rem;">
                <!-- 예약번호 & 상태 헤더 -->
                <div class="reservation-header">
                    <span class="reservation-number" th:text="'#' + ${reservation.reservationNumber}">R000001</span>
                    <span th:class="'status-badge ' + ${reservation.status.name().toLowerCase()}"
                          th:text="${reservation.status.description}">확정</span>
                </div>

                <!-- 정보 그리드 -->
                <div class="info-grid">
                    <div class="info-item">
                        <div class="info-label">고객명</div>
                        <div class="info-value" th:text="${reservation.customerName}">홍길동</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">연락처</div>
                        <div class="info-value" th:text="${reservation.phone}">010-1234-5678</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">이메일</div>
                        <div class="info-value" th:text="${reservation.email} ?: '-'">hong@example.com</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">상담일시</div>
                        <div class="info-value">
                            <span th:text="${#temporals.format(reservation.reservationDate, 'yyyy-MM-dd')}">2026-01-25</span>
                            <span th:text="${#temporals.format(reservation.reservationTime, 'HH:mm')}">14:00</span>
                        </div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">상담 유형</div>
                        <div class="info-value" th:text="${reservation.consultationType.description}">종합소득세 신고</div>
                    </div>

                    <div class="info-item">
                        <div class="info-label">등록일</div>
                        <div class="info-value" th:text="${#temporals.format(reservation.createdAt, 'yyyy-MM-dd HH:mm')}">2026-01-20 09:30</div>
                    </div>
                </div>

                <!-- 메모 -->
                <div class="memo-section" th:if="${reservation.memo != null and !reservation.memo.isEmpty()}">
                    <div class="info-label">메모</div>
                    <div class="info-value" th:text="${reservation.memo}">메모 내용</div>
                </div>
            </div>
        </div>

        <!-- 하단 액션 영역 -->
        <div class="detail-actions">
            <!-- 목록/수정 버튼 -->
            <div class="action-buttons">
                <a th:href="@{/admin/reservations}" class="btn btn-outline">← 목록</a>
                <a th:href="@{/admin/reservations/{id}/edit(id=${reservation.id})}" class="btn btn-primary">수정하기</a>
            </div>

            <!-- 상태 변경 (취소되지 않은 경우만) -->
            <div class="status-card" th:if="${reservation.status.name() != 'CANCELLED'}">
                <div class="status-card-title">상태 변경</div>
                <div class="status-actions">
                    <form th:action="@{/admin/reservations/{id}/complete(id=${reservation.id})}" method="post" style="flex: 1; margin: 0;">
                        <button type="submit" class="status-btn complete"
                                th:disabled="${reservation.status.name() == 'COMPLETED'}"
                                onclick="return confirm('상담 완료로 변경하시겠습니까?');">
                            완료
                        </button>
                    </form>

                    <form th:action="@{/admin/reservations/{id}/cancel(id=${reservation.id})}" method="post" style="flex: 1; margin: 0;">
                        <button type="submit" class="status-btn cancel"
                                onclick="return confirm('예약을 취소하시겠습니까?');">
                            취소
                        </button>
                    </form>

                    <form th:action="@{/admin/reservations/{id}/no-show(id=${reservation.id})}" method="post" style="flex: 1; margin: 0;">
                        <button type="submit" class="status-btn noshow"
                                th:disabled="${reservation.status.name() == 'NO_SHOW'}"
                                onclick="return confirm('노쇼로 처리하시겠습니까?');">
                            노쇼
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </th:block>
</body>
</html>